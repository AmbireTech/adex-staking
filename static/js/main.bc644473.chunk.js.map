{"version":3,"sources":["adex-staking.svg","themeMUi.js","components/StatsCard.js","helpers/formatting.js","helpers/bonds.js","components/Dashboard.js","components/RewardCard.js","components/NewBondForm.js","components/ConfirmationDialog.js","components/LegacyADXSwapDialog.js","App.js","serviceWorker.js","index.js","components/HelperMenu.js","helpers/identity.js","helpers/constants.js"],"names":["module","exports","palette","primary","main","contrastText","accentOne","accentTwo","grey","error","deepOrange","warning","amber","first","lime","contrastThreshold","tonalOffset","text","theme","createMuiTheme","typography","fontFamily","fontSize","overrides","MuiButton","root","borderRadius","outlined","MuiTableCell","head","whiteSpace","MuiPaper","rounded","MuiTooltip","tooltip","backgroundColor","arrow","color","themeMUI","responsiveFontSizes","options","factor","StatsCard","title","subtitle","extra","loaded","actions","extraElem","Typography","variant","Paper","elevation","style","height","padding","spacing","minHeight","length","LinearProgress","formatADX","num","formatUnits","formatADXPretty","div","parseADX","n","parseUnits","getApproxAPY","bond","totalStake","isEarly","nonce","toNumber","Date","now","base","parseFloat","early","getPool","poolId","POOLS","find","x","id","getBondId","owner","amount","keccak256","defaultAbiCoder","encode","ADDR_STAKING","Dashboard","stats","onRequestUnbond","onUnbond","onClaimRewards","onRestake","userTotalStake","userBonds","filter","status","map","currentAmount","reduce","a","b","add","ZERO","useState","prices","setPrices","useEffect","fetch","PRICES_API_URL","then","r","json","catch","console","inUSD","adxAmount","USD","usdAmount","toFixed","bondExplanationMsg","UNBOND_DAYS","bondExplanationFrag","Grid","item","xs","marginTop","Alert","square","severity","headerCellStyle","fontWeight","container","alignItems","maxWidth","margin","md","sm","rewardChannels","sumRewards","all","outstandingReward","totalRewardADX","channelArgs","tokenAddr","ADDR_ADX","totalRewardDAI","restakeEnabled","gt","Box","display","flexDirection","paddingTop","Button","size","disabled","eq","onClick","ml","RewardCard","userBalance","TableContainer","Table","aria-label","TableHead","TableRow","TableCell","align","TableBody","reverse","d","pool","poolLabel","label","created","time","key","getDate","toLocaleString","month","getFullYear","willUnlock","getTime","days","Math","ceil","bondStatus","NewBondForm","maxAmount","onNewBond","pools","DEFAULT_BOND","setBond","stakingAmount","setStakingAmount","amountErr","setAmountErr","amountErrText","setAmountErrText","confirmation","setConfirmation","setPool","minWidthStyle","minWidth","activePool","stakingRulesFrag","STAKING_RULES_URL","target","rel","href","confirmationLabel","validateFields","params","amountBN","poolToValidate","minStakingAmountBN","minStakingAmount","lt","updateStakingAmountBN","farmer","role","width","TextField","required","type","value","onChange","ev","max","toString","helperText","FormControl","InputLabel","Select","updatePool","MenuItem","rewardPolicy","slashPolicy","FormControlLabel","userSelect","control","Checkbox","checked","ConfirmationDialog","isOpen","onDeny","onConfirm","content","confirmActionName","Dialog","open","onClose","DialogTitle","DialogContent","DialogActions","ADDR_ADX_OLD","provider","getDefaultProvider","LegacyToken","Contract","ERC20ABI","LegacyADXSwapDialog","getSigner","wrapDoingTxns","setAmount","isSwapInPrg","setSwapInPrg","async","signer","getAddress","walletAddr","balanceOf","refreshAmount","e","onSwap","swapTokens","bind","dialog","txns","Promise","wait","Snackbar","legacyTokenWithSigner","newTokenWithSigner","allowance","hasAutocalculatedGas","firstTimeGasLimit","gasLimit","approve","push","swap","ADDR_CORE","Staking","StakingABI","Token","Core","CoreABI","MAX_SLASH","bigNumberify","OUTSTANDING_REWARD_THRESHOLD","EMPTY_STATS","props","window","ethereum","enable","web3","Web3Provider","currentProvider","loadUserStats","addr","loadBondStats","getRewards","bondStats","identityAddr","getUserIdentity","getLogs","fromBlock","address","topics","hexZeroPad","filters","LogSlash","balances","logs","slashLogs","slashedByPool","log","interface","parseLog","values","newSlashPts","bonds","topic","evs","events","LogBond","vals","slashedAtStart","mul","sub","LogUnbondRequested","bondId","LogUnbonded","rewardPool","url","resp","validUntil","floor","rewardChannel","claimFrom","balanceTree","BalanceTree","withdrawnPerUser","channelId","proof","getProof","stateRoot","mTree","getRoot","forUser","createNewBond","Error","allowanceStaking","balanceOnIdentity","needed","setAllowance","gte","tokenWithSigner","MAX_UINT","identityTxns","functions","transferFrom","active","stakingData","replaceBond","addBond","executeOnIdentity","onUnbondOrRequest","isUnbond","unbond","transfer","requestUnbond","claimRewards","coreWithSigner","legacyChannels","channel","channelTuple","toChannelTuple","channelWithdraw","signatures","toTransfer","forEach","amnt","concat","Object","entries","restake","channels","collected","userBond","newBond","args","creator","tokenAmount","validators","spec","opts","bytecode","identity","IdentityABI","getCode","needsToDeploy","idNonce","toTuples","offset","i","to","data","zeroFeeTx","toSolidityTuple","txnTuples","executeBySender","factoryWithSigner","ADDR_FACTORY","FactoryABI","executeTx","signMessage","hash","sig","deployAndExecute","splitSig","Boolean","location","hostname","match","ReactDOM","render","isNewBondOpen","setNewBondOpen","toUnbond","setToUnbond","toRestake","setToRestake","openErr","setOpenErr","openDoingTx","setOpenDoingTx","snackbarErr","setSnackbarErr","setStats","refreshStats","userStats","loadStats","code","intvl","setInterval","clearInterval","fn","apply","res","message","handleErrClose","event","reason","AppBar","position","Toolbar","src","logo","alt","Fab","right","top","menuEl","setMenuEl","closeHelpMenu","IconButton","currentTarget","Menu","anchorEl","keepMounted","getContentAnchorEl","anchorOrigin","vertical","horizontal","transformOrigin","Link","HelperMenu","autoHideDuration","Modal","justifyContent","closeAfterTransition","BackdropComponent","Backdrop","BackdropProps","timeout","Fade","in","selectable","document","getElementById","navigator","serviceWorker","ready","registration","unregister","addrHex","slice","toLowerCase","getBytecode","generateAddress2","Buffer","alloc","idAddr","Transaction","identityContract","feeTokenAddr","feeAmount","estimatedAnnualFeeYield","estimatedAnnualADXYield","estimatedAnnualADXEarlyYield"],"mappings":"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","file":"static/js/main.bc644473.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/adex-staking.bf64bad2.svg\";","import { createMuiTheme, responsiveFontSizes } from \"@material-ui/core/styles\"\nimport lime from \"@material-ui/core/colors/lime\"\nimport deepOrange from \"@material-ui/core/colors/deepOrange\"\nimport amber from \"@material-ui/core/colors/amber\"\nimport grey from \"@material-ui/core/colors/grey\"\n\nconst WHITE = \"#fff\"\nexport const PRIMARY = \"#1B75BC\"\nexport const SECONDARY = \"#FFAC00\"\nexport const ALEX_GREY = \"#3f3e3e\"\nexport const ACCENT_ONE = \"#57467B\"\nexport const ACCENT_TWO = \"#7CB4B8\"\n\nconst palette = {\n\tprimary: { main: PRIMARY, contrastText: WHITE },\n\t//secondary: { main: SECONDARY, contrastText: WHITE },\n\taccentOne: { main: ACCENT_ONE, contrastText: WHITE },\n\taccentTwo: { main: ACCENT_TWO, contrastText: WHITE },\n\tgrey: { main: ALEX_GREY, contrastText: WHITE },\n\terror: deepOrange,\n\twarning: amber,\n\tfirst: lime,\n\tcontrastThreshold: 3,\n\ttonalOffset: 0.2,\n\ttext: grey\n}\n\nconst theme = createMuiTheme({\n\ttypography: {\n\t\tfontFamily: '\"Roboto\", \"Helvetica\", \"Arial\", sans-serif',\n\t\tfontSize: 14\n\t},\n\tpalette: { ...palette },\n\toverrides: {\n\t\tMuiButton: {\n\t\t\troot: {\n\t\t\t\tborderRadius: 0\n\t\t\t},\n\t\t\toutlined: {\n\t\t\t\tborderRadius: 0\n\t\t\t}\n\t\t},\n\t\tMuiTableCell: {\n\t\t\thead: {\n\t\t\t\twhiteSpace: \"nowrap\"\n\t\t\t},\n\t\t\troot: {\n\t\t\t\twhiteSpace: \"nowrap\"\n\t\t\t}\n\t\t},\n\t\tMuiPaper: {\n\t\t\trounded: {\n\t\t\t\tborderRadius: 0\n\t\t\t}\n\t\t},\n\t\tMuiTooltip: {\n\t\t\ttooltip: {\n\t\t\t\tborderRadius: 0,\n\t\t\t\tfontSize: \"0.9em\",\n\t\t\t\tbackgroundColor: `rgba(0,0,0, 0.69)`\n\t\t\t},\n\t\t\tarrow: { color: `rgba(0,0,0, 0.69)` }\n\t\t}\n\t}\n})\n\nexport const themeMUI = responsiveFontSizes(theme, {\n\toptions: [\"xs\", \"sm\", \"md\", \"lg\", \"xl\"],\n\tfactor: 3\n})\n","import React from \"react\"\nimport { Paper } from \"@material-ui/core\"\nimport LinearProgress from \"@material-ui/core/LinearProgress\"\nimport Typography from \"@material-ui/core/Typography\"\nimport { themeMUI } from \"../themeMUi\"\n\nexport default function StatsCard({ title, subtitle, extra, loaded, actions }) {\n\tconst extraElem =\n\t\ttypeof extra === \"string\" ? (\n\t\t\t<Typography color=\"primary\" variant=\"h6\">\n\t\t\t\t{extra}\n\t\t\t</Typography>\n\t\t) : (\n\t\t\textra || <></>\n\t\t)\n\treturn (\n\t\t<Paper elevation={3} style={{ height: \"100%\" }}>\n\t\t\t<div style={{ padding: themeMUI.spacing(2), minHeight: \"85px\" }}>\n\t\t\t\t<Typography variant={subtitle.length > 16 ? \"h6\" : \"h5\"}>\n\t\t\t\t\t{subtitle}\n\t\t\t\t</Typography>\n\t\t\t\t{extraElem}\n\t\t\t\t<Typography color=\"textSecondary\" variant=\"subtitle2\">\n\t\t\t\t\t{title}\n\t\t\t\t</Typography>\n\t\t\t\t{actions || <></>}\n\t\t\t</div>\n\t\t\t{!loaded ? <LinearProgress /> : <></>}\n\t\t</Paper>\n\t)\n}\n","import { formatUnits, parseUnits } from \"ethers/utils\"\n\nexport function formatADX(num) {\n\treturn formatUnits(num, 18)\n}\n\nexport function formatADXPretty(num) {\n\treturn formatUnits(num.div(\"100000000000000\"), 4)\n}\n\nexport function formatDAI(num) {\n\treturn formatUnits(num, 18)\n}\n\nexport function formatDAIPretty(num) {\n\treturn formatUnits(num.div(\"10000000000000000\"), 2)\n}\n\nexport function parseADX(n) {\n\treturn parseUnits(n, 18)\n}\n\nexport function formatDate(d) {\n\treturn `${d.getDate()} ${d.toLocaleString(\"default\", {\n\t\tmonth: \"short\"\n\t})} ${d.getFullYear()}`\n}\n\n// @TODO refactor to take pool arguments and use pool constants\nexport function getApproxAPY(bond, totalStake) {\n\tconst earlyDistributionEnds = 1609372800000\n\tconst bondCreatedSeconds =\n\t\tbond && bond.nonce ? bond.nonce.toNumber() : Date.now() / 1000\n\tconst isEarly =\n\t\tbondCreatedSeconds < 1597276800 && Date.now() < earlyDistributionEnds\n\t// this reward is distributed over that many days, hence * (365/145)\n\tconst base = (6000000 / parseFloat(formatADX(totalStake), 10)) * (365 / 145)\n\tconst early = (1000000 / parseFloat(formatADX(totalStake), 10)) * (365 / 30)\n\treturn base + (isEarly ? early : 0)\n\t// @TODO DAI rewards\n}\n","import { POOLS, ADDR_STAKING } from \"./constants\"\nimport { keccak256, defaultAbiCoder } from \"ethers/utils\"\n\nexport const getPool = poolId => POOLS.find(x => x.id === poolId)\nexport function getBondId({ owner, amount, poolId, nonce }) {\n\treturn keccak256(\n\t\tdefaultAbiCoder.encode(\n\t\t\t[\"address\", \"address\", \"uint\", \"bytes32\", \"uint\"],\n\t\t\t[ADDR_STAKING, owner, amount, poolId, nonce]\n\t\t)\n\t)\n}\n","import React, { useState, useEffect } from \"react\"\nimport {\n\tTableRow,\n\tTableCell,\n\tButton,\n\tGrid,\n\tTable,\n\tTableContainer,\n\tTableHead,\n\tTableBody\n} from \"@material-ui/core\"\nimport { Alert } from \"@material-ui/lab\"\nimport { themeMUI } from \"../themeMUi\"\nimport RewardCard from \"./RewardCard\"\nimport StatsCard from \"./StatsCard\"\nimport { UNBOND_DAYS, ZERO, PRICES_API_URL } from \"../helpers/constants\"\nimport {\n\tformatADXPretty,\n\tformatADX,\n\tgetApproxAPY,\n\tformatDate\n} from \"../helpers/formatting\"\nimport { getPool, getBondId } from \"../helpers/bonds\"\n\nexport default function Dashboard({\n\tstats,\n\tonRequestUnbond,\n\tonUnbond,\n\tonClaimRewards,\n\tonRestake\n}) {\n\tconst userTotalStake = stats.userBonds\n\t\t.filter(x => x.status === \"Active\")\n\t\t.map(x => x.currentAmount)\n\t\t.reduce((a, b) => a.add(b), ZERO)\n\n\t// USD values\n\tconst [prices, setPrices] = useState({})\n\tconst refreshPrices = () =>\n\t\tfetch(PRICES_API_URL)\n\t\t\t.then(r => r.json())\n\t\t\t.then(setPrices)\n\t\t\t.catch(console.error)\n\tuseEffect(() => {\n\t\trefreshPrices()\n\t}, [])\n\tconst inUSD = adxAmount => {\n\t\tif (!adxAmount) return null\n\t\tif (!prices.USD) return null\n\t\tconst usdAmount = parseFloat(formatADX(adxAmount), 10) * prices.USD\n\t\treturn `${usdAmount.toFixed(2)} USD`\n\t}\n\n\t// Render all stats cards + bond table\n\tconst bondStatus = bond => {\n\t\tif (bond.status === \"UnbondRequested\") {\n\t\t\tconst willUnlock = bond.willUnlock.getTime()\n\t\t\tconst now = Date.now()\n\t\t\tif (willUnlock > now) {\n\t\t\t\tconst days = Math.ceil((willUnlock - now) / 86400000)\n\t\t\t\treturn `Can unbond in ${days} days`\n\t\t\t} else {\n\t\t\t\treturn \"Can unbond\"\n\t\t\t}\n\t\t}\n\t\tif (bond.status === \"Active\") {\n\t\t\treturn `Active, earning ${(\n\t\t\t\tgetApproxAPY(bond, stats.totalStake) * 100\n\t\t\t).toFixed(2)}% APY`\n\t\t}\n\t\treturn bond.status\n\t}\n\n\tconst renderBondRow = bond => {\n\t\tconst pool = getPool(bond.poolId)\n\t\tconst poolLabel = pool ? pool.label : bond.poolId\n\t\tconst created = new Date(\n\t\t\t(bond.nonce.gt(ZERO) ? bond.nonce : bond.time).toNumber() * 1000\n\t\t)\n\t\treturn (\n\t\t\t<TableRow key={getBondId(bond)}>\n\t\t\t\t<TableCell>{formatADXPretty(bond.currentAmount)} ADX</TableCell>\n\t\t\t\t<TableCell align=\"right\">{poolLabel}</TableCell>\n\t\t\t\t<TableCell align=\"right\">{formatDate(created)}</TableCell>\n\t\t\t\t<TableCell align=\"right\">{bondStatus(bond)}</TableCell>\n\t\t\t\t<TableCell align=\"right\">\n\t\t\t\t\t{bond.status === \"Active\" ? (\n\t\t\t\t\t\t<Button color=\"primary\" onClick={() => onRequestUnbond(bond)}>\n\t\t\t\t\t\t\tRequest Unbond\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\t\tbond.status === \"Unbonded\" ||\n\t\t\t\t\t\t\t\t!bond.willUnlock ||\n\t\t\t\t\t\t\t\tbond.willUnlock.getTime() > Date.now()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonClick={() => onUnbond(bond)}\n\t\t\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tUnbond\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</TableCell>\n\t\t\t</TableRow>\n\t\t)\n\t}\n\n\tconst bondExplanationMsg = `This table will show all your individual ADX deposits (bonds), along\n\t\twith information as status, amount and earned reward. By using the\n\t\taction buttons, you will be able to request unbonding and withdraw your\n\t\tADX after the ${UNBOND_DAYS} day lock-up period.`\n\n\tconst bondExplanationFrag =\n\t\t!stats.loaded || stats.userBonds.length ? (\n\t\t\t<></>\n\t\t) : (\n\t\t\t<Grid item xs={12} style={{ marginTop: themeMUI.spacing(2) }}>\n\t\t\t\t<Alert square elevation={6} variant=\"filled\" severity=\"info\">\n\t\t\t\t\t{bondExplanationMsg}\n\t\t\t\t</Alert>\n\t\t\t</Grid>\n\t\t)\n\n\tconst headerCellStyle = { fontWeight: \"bold\" }\n\treturn (\n\t\t<Grid\n\t\t\tcontainer\n\t\t\talignItems=\"stretch\"\n\t\t\tstyle={{\n\t\t\t\tpadding: themeMUI.spacing(4),\n\t\t\t\tmaxWidth: \"1200px\",\n\t\t\t\tmargin: \"auto\"\n\t\t\t}}\n\t\t\tspacing={2}\n\t\t>\n\t\t\t<Grid item md={3} sm={6} xs={12}>\n\t\t\t\t{RewardCard({\n\t\t\t\t\trewardChannels: stats.rewardChannels,\n\t\t\t\t\tuserBonds: stats.userBonds,\n\t\t\t\t\tonClaimRewards,\n\t\t\t\t\tonRestake\n\t\t\t\t})}\n\t\t\t</Grid>\n\n\t\t\t<Grid item md={3} sm={6} xs={12}>\n\t\t\t\t{StatsCard({\n\t\t\t\t\tloaded: stats.loaded,\n\t\t\t\t\ttitle: \"Total ADX staked\",\n\t\t\t\t\textra: inUSD(stats.totalStake),\n\t\t\t\t\tsubtitle: formatADXPretty(stats.totalStake) + \" ADX\"\n\t\t\t\t})}\n\t\t\t</Grid>\n\n\t\t\t<Grid item md={3} sm={6} xs={12}>\n\t\t\t\t{StatsCard({\n\t\t\t\t\tloaded: stats.loaded,\n\t\t\t\t\ttitle: \"Your total active stake\",\n\t\t\t\t\textra: inUSD(userTotalStake),\n\t\t\t\t\tsubtitle: formatADXPretty(userTotalStake) + \" ADX\"\n\t\t\t\t})}\n\t\t\t</Grid>\n\n\t\t\t<Grid item md={3} sm={6} xs={12}>\n\t\t\t\t{StatsCard({\n\t\t\t\t\tloaded: stats.loaded,\n\t\t\t\t\ttitle: \"Your balance\",\n\t\t\t\t\tsubtitle: stats.userBalance\n\t\t\t\t\t\t? formatADXPretty(stats.userBalance) + \" ADX\"\n\t\t\t\t\t\t: \"\",\n\t\t\t\t\textra: inUSD(stats.userBalance)\n\t\t\t\t\t/*actions: (<Button\n\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\tvariant=\"contained\"\n\t\t\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\t\t\tdisabled={true}\n\t\t\t\t\t\t>upgrade</Button>)*/\n\t\t\t\t})}\n\t\t\t</Grid>\n\n\t\t\t<TableContainer xs={12}>\n\t\t\t\t<Table\n\t\t\t\t\taria-label=\"Bonds table\"\n\t\t\t\t\tstyle={{ marginTop: themeMUI.spacing(2) }}\n\t\t\t\t>\n\t\t\t\t\t<TableHead>\n\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t<TableCell style={headerCellStyle}>Bond amount</TableCell>\n\t\t\t\t\t\t\t<TableCell style={headerCellStyle} align=\"right\">\n\t\t\t\t\t\t\t\tPool\n\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t<TableCell style={headerCellStyle} align=\"right\">\n\t\t\t\t\t\t\t\tCreated\n\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t<TableCell style={headerCellStyle} align=\"right\">\n\t\t\t\t\t\t\t\tStatus\n\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t<TableCell style={headerCellStyle} align=\"right\">\n\t\t\t\t\t\t\t\tActions\n\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t</TableHead>\n\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t{[...(stats.userBonds || [])]\n\t\t\t\t\t\t\t.filter(x => x.status !== \"Unbonded\")\n\t\t\t\t\t\t\t.reverse()\n\t\t\t\t\t\t\t.map(renderBondRow)}\n\t\t\t\t\t</TableBody>\n\t\t\t\t</Table>\n\t\t\t</TableContainer>\n\n\t\t\t{bondExplanationFrag}\n\t\t</Grid>\n\t)\n}\n","import React from \"react\"\nimport StatsCard from \"./StatsCard\"\nimport { ZERO, ADDR_ADX } from \"../helpers/constants\"\nimport { Button, Box } from \"@material-ui/core\"\nimport { formatDAIPretty, formatADXPretty } from \"../helpers/formatting\"\n\nexport default function RewardCard({\n\trewardChannels,\n\tuserBonds,\n\tonClaimRewards,\n\tonRestake\n}) {\n\tconst title = \"Your total unclaimed reward\"\n\tconst loaded = rewardChannels != null\n\tif (!loaded) {\n\t\treturn StatsCard({\n\t\t\tloaded,\n\t\t\ttitle,\n\t\t\textra: \"0.00 USD\",\n\t\t\tsubtitle: \"0.00 DAI\"\n\t\t})\n\t}\n\tconst sumRewards = all =>\n\t\tall.map(x => x.outstandingReward).reduce((a, b) => a.add(b), ZERO)\n\tconst totalRewardADX = sumRewards(\n\t\trewardChannels.filter(x => x.channelArgs.tokenAddr === ADDR_ADX)\n\t)\n\tconst totalRewardDAI = sumRewards(\n\t\trewardChannels.filter(x => x.channelArgs.tokenAddr !== ADDR_ADX)\n\t)\n\tconst restakeEnabled =\n\t\ttotalRewardADX.gt(ZERO) && userBonds.find(x => x.status !== \"Unbonded\")\n\tconst rewardActions = (\n\t\t<Box display=\"flex\" flexDirection=\"row\" paddingTop={1}>\n\t\t\t<Button\n\t\t\t\tsize=\"small\"\n\t\t\t\tvariant=\"contained\"\n\t\t\t\tcolor=\"secondary\"\n\t\t\t\tdisabled={totalRewardADX.add(totalRewardDAI).eq(ZERO)}\n\t\t\t\tonClick={() => onClaimRewards(rewardChannels)}\n\t\t\t>\n\t\t\t\tclaim\n\t\t\t</Button>\n\t\t\t<Box ml={1}>\n\t\t\t\t<Button\n\t\t\t\t\tsize=\"small\"\n\t\t\t\t\tvariant=\"contained\"\n\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\tdisabled={!restakeEnabled}\n\t\t\t\t\tonClick={() => onRestake(totalRewardADX)}\n\t\t\t\t>\n\t\t\t\t\tre-stake\n\t\t\t\t</Button>\n\t\t\t</Box>\n\t\t</Box>\n\t)\n\treturn StatsCard({\n\t\tloaded: true,\n\t\ttitle,\n\t\tactions: rewardActions,\n\t\tsubtitle: totalRewardDAI.gt(ZERO)\n\t\t\t? `${formatADXPretty(totalRewardADX)} ADX, ${formatDAIPretty(\n\t\t\t\t\ttotalRewardDAI\n\t\t\t  )} DAI`\n\t\t\t: `${formatADXPretty(totalRewardADX)} ADX`\n\t})\n}\n","import React, { useState } from \"react\"\nimport { getPool } from \"../helpers/bonds\"\nimport {\n\tparseADX,\n\tformatADX,\n\tformatADXPretty,\n\tgetApproxAPY\n} from \"../helpers/formatting\"\nimport {\n\tUNBOND_DAYS,\n\tZERO,\n\tDEFAULT_BOND,\n\tSTAKING_RULES_URL\n} from \"../helpers/constants\"\nimport {\n\tPaper,\n\tGrid,\n\tTextField,\n\tTypography,\n\tButton,\n\tFormControl,\n\tInputLabel,\n\tSelect,\n\tMenuItem,\n\tFormControlLabel,\n\tCheckbox\n} from \"@material-ui/core\"\nimport { themeMUI } from \"../themeMUi\"\n\nexport default function NewBondForm({\n\tmaxAmount,\n\tonNewBond,\n\ttotalStake,\n\tpools\n}) {\n\tconst [bond, setBond] = useState(DEFAULT_BOND)\n\tconst [stakingAmount, setStakingAmount] = useState(0)\n\tconst [amountErr, setAmountErr] = useState(false)\n\tconst [amountErrText, setAmountErrText] = useState(\"\")\n\tconst [confirmation, setConfirmation] = useState(false)\n\tconst [pool, setPool] = useState(\"\")\n\tconst minWidthStyle = { minWidth: \"180px\" }\n\tconst activePool = getPool(pool)\n\n\tconst onAction = () => {\n\t\tsetConfirmation(false)\n\t\tonNewBond(bond)\n\t}\n\n\tconst stakingRulesFrag = STAKING_RULES_URL ? (\n\t\t<>\n\t\t\t&nbsp;and{\" \"}\n\t\t\t<a target=\"_blank\" rel=\"noopener noreferrer\" href={STAKING_RULES_URL}>\n\t\t\t\tstaking conditions\n\t\t\t</a>\n\t\t</>\n\t) : (\n\t\t<></>\n\t)\n\tconst confirmationLabel = (\n\t\t<>\n\t\t\tI understand I am locking up my ADX for at least {UNBOND_DAYS} days and I\n\t\t\tam familiar with the&nbsp;\n\t\t\t<a\n\t\t\t\thref=\"https://www.adex.network/tos/\"\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t>\n\t\t\t\tTerms and conditions\n\t\t\t</a>\n\t\t\t{stakingRulesFrag}.\n\t\t</>\n\t)\n\n\tconst validateFields = params => {\n\t\tconst { amountBN, poolToValidate } = params\n\t\tconst minStakingAmountBN = poolToValidate\n\t\t\t? parseADX(poolToValidate.minStakingAmount)\n\t\t\t: ZERO\n\t\tif (amountBN.gt(maxAmount)) {\n\t\t\tsetAmountErr(true)\n\t\t\tsetAmountErrText(\"Insufficient ADX amount!\")\n\t\t\treturn\n\t\t}\n\t\tif (poolToValidate && amountBN.lt(minStakingAmountBN)) {\n\t\t\tsetAmountErr(true)\n\t\t\tsetAmountErrText(\n\t\t\t\t\"ADX amount less than minimum required for selected pool!\"\n\t\t\t)\n\t\t\treturn\n\t\t}\n\t\tsetAmountErr(false)\n\t\treturn\n\t}\n\n\tconst updateStakingAmountBN = amountBN => {\n\t\tvalidateFields({ amountBN, poolToValidate: activePool })\n\t\tsetStakingAmount(formatADX(amountBN))\n\t\tsetBond({\n\t\t\t...bond,\n\t\t\tamount: amountBN\n\t\t})\n\t}\n\n\tconst updatePool = value => {\n\t\tconst amountBN = parseADX(stakingAmount)\n\t\tconst poolToValidate = getPool(value)\n\t\tvalidateFields({ amountBN, poolToValidate })\n\t\tsetPool(value)\n\t\tsetBond({ ...bond, poolId: value })\n\t}\n\n\tconst farmer = (\n\t\t<span role=\"img\" aria-label=\"farmer\">\n\t\t\tðŸŒ¾\n\t\t</span>\n\t)\n\n\treturn (\n\t\t<Paper\n\t\t\televation={2}\n\t\t\tstyle={{ width: \"500px\", padding: themeMUI.spacing(2, 4, 3) }}\n\t\t>\n\t\t\t<h2>Create a bond</h2>\n\t\t\t<Grid container spacing={2}>\n\t\t\t\t<Grid item xs={6}>\n\t\t\t\t\t<TextField\n\t\t\t\t\t\trequired\n\t\t\t\t\t\tlabel=\"ADX amount\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tstyle={minWidthStyle}\n\t\t\t\t\t\tvalue={stakingAmount}\n\t\t\t\t\t\terror={amountErr}\n\t\t\t\t\t\tonChange={ev => {\n\t\t\t\t\t\t\t// since its a number input it can be a negative number which wouldn't make sense so we cap it at 0\n\t\t\t\t\t\t\tconst amount = Math.max(0, ev.target.value)\n\t\t\t\t\t\t\tconst amountBN = parseADX(amount.toString(10))\n\t\t\t\t\t\t\tupdateStakingAmountBN(amountBN)\n\t\t\t\t\t\t\tsetStakingAmount(amount.toString(10))\n\t\t\t\t\t\t}}\n\t\t\t\t\t\thelperText={amountErr ? amountErrText : null}\n\t\t\t\t\t></TextField>\n\t\t\t\t\t<Typography variant=\"subtitle2\">\n\t\t\t\t\t\tMax amount:\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tupdateStakingAmountBN(maxAmount)\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{formatADXPretty(maxAmount)} ADX\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Typography>\n\t\t\t\t</Grid>\n\t\t\t\t<Grid item xs={6}>\n\t\t\t\t\t<FormControl required>\n\t\t\t\t\t\t<InputLabel>Pool</InputLabel>\n\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\tstyle={minWidthStyle}\n\t\t\t\t\t\t\tvalue={pool}\n\t\t\t\t\t\t\tonChange={ev => updatePool(ev.target.value)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<MenuItem value={\"\"}>\n\t\t\t\t\t\t\t\t<em>None</em>\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t{pools.map(({ label, id }) => (\n\t\t\t\t\t\t\t\t<MenuItem key={id} value={id}>\n\t\t\t\t\t\t\t\t\t{label}\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t</FormControl>\n\t\t\t\t</Grid>\n\t\t\t\t{activePool ? (\n\t\t\t\t\t<Grid item xs={12}>\n\t\t\t\t\t\t<Grid item xs={12}>\n\t\t\t\t\t\t\t<Typography variant=\"h6\">Pool reward policy:</Typography>\n\t\t\t\t\t\t\t<Typography variant=\"body1\">{activePool.rewardPolicy}</Typography>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t<Grid item xs={12} style={{ marginTop: themeMUI.spacing(2) }}>\n\t\t\t\t\t\t\t<Typography variant=\"h6\">Pool slashing policy:</Typography>\n\t\t\t\t\t\t\t<Typography variant=\"body1\">{activePool.slashPolicy}</Typography>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t<Grid item xs={12} style={{ marginTop: themeMUI.spacing(2) }}>\n\t\t\t\t\t\t\t<Typography variant=\"h6\">Pool APY:</Typography>\n\t\t\t\t\t\t\t<Typography variant=\"body1\">\n\t\t\t\t\t\t\t\t{farmer} Current annual yield of{\" \"}\n\t\t\t\t\t\t\t\t{(getApproxAPY(null, totalStake) * 100).toFixed(2)}% {farmer}\n\t\t\t\t\t\t\t</Typography>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t<Grid item xs={12} style={{ marginTop: themeMUI.spacing(2) }}>\n\t\t\t\t\t\t\t<Typography variant=\"body1\">\n\t\t\t\t\t\t\t\t<b>Please sign ALL Metamask transactions that pop up.</b>\n\t\t\t\t\t\t\t</Typography>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t</Grid>\n\t\t\t\t) : (\n\t\t\t\t\t\"\"\n\t\t\t\t)}\n\t\t\t\t<Grid item xs={12}>\n\t\t\t\t\t<FormControlLabel\n\t\t\t\t\t\tstyle={{ userSelect: \"none\" }}\n\t\t\t\t\t\tlabel={confirmationLabel}\n\t\t\t\t\t\tcontrol={\n\t\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\t\tchecked={confirmation}\n\t\t\t\t\t\t\t\tonChange={ev => setConfirmation(ev.target.checked)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t}\n\t\t\t\t\t></FormControlLabel>\n\t\t\t\t</Grid>\n\t\t\t\t<Grid item xs={12}>\n\t\t\t\t\t<FormControl style={{ display: \"flex\" }}>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\tbond.poolId &&\n\t\t\t\t\t\t\t\t\tconfirmation &&\n\t\t\t\t\t\t\t\t\tbond.amount.gt(ZERO) &&\n\t\t\t\t\t\t\t\t\t!amountErr\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcolor=\"primary\"\n\t\t\t\t\t\t\tvariant=\"contained\"\n\t\t\t\t\t\t\tonClick={onAction}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tStake ADX\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</FormControl>\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t</Paper>\n\t)\n}\n","import React from \"react\"\nimport {\n\tDialog,\n\tDialogTitle,\n\tDialogContent,\n\tDialogActions,\n\tButton\n} from \"@material-ui/core\"\n\nexport default function ConfirmationDialog({\n\tisOpen,\n\tonDeny,\n\tonConfirm,\n\tcontent,\n\ttitle = \"Are you sure?\",\n\tconfirmActionName\n}) {\n\treturn (\n\t\t<Dialog open={isOpen} onClose={onDeny}>\n\t\t\t<DialogTitle id=\"alert-dialog-title\">{title}</DialogTitle>\n\t\t\t<DialogContent>{content}</DialogContent>\n\t\t\t<DialogActions>\n\t\t\t\t<Button onClick={onDeny} color=\"primary\">\n\t\t\t\t\tCancel\n\t\t\t\t</Button>\n\t\t\t\t<Button onClick={onConfirm} variant=\"contained\" color=\"primary\">\n\t\t\t\t\t{confirmActionName}\n\t\t\t\t</Button>\n\t\t\t</DialogActions>\n\t\t</Dialog>\n\t)\n}\n","import React, { useEffect, useState } from \"react\"\nimport { Contract, getDefaultProvider } from \"ethers\"\nimport Snackbar from \"@material-ui/core/Snackbar\"\nimport MuiAlert from \"@material-ui/lab/Alert\"\nimport { formatUnits } from \"ethers/utils\"\nimport ConfirmationDialog from \"./ConfirmationDialog\"\nimport { ZERO, ADDR_ADX } from \"../helpers/constants\"\nimport ERC20ABI from \"../abi/ERC20\"\n\nconst ADDR_ADX_OLD = \"0x4470BB87d77b963A013DB939BE332f927f2b992e\"\n\nconst provider = getDefaultProvider()\nconst LegacyToken = new Contract(ADDR_ADX_OLD, ERC20ABI, provider)\n\nexport default function LegacyADXSwapDialog(getSigner, wrapDoingTxns) {\n\t// Amount to migrate\n\tconst [amount, setAmount] = useState(ZERO)\n\tconst [isSwapInPrg, setSwapInPrg] = useState(false)\n\n\tuseEffect(() => {\n\t\tif (!getSigner) return\n\t\tconst refreshAmount = async () => {\n\t\t\tconst signer = await getSigner()\n\t\t\tif (!signer) return\n\t\t\tconst walletAddr = await signer.getAddress()\n\t\t\tsetAmount(await LegacyToken.balanceOf(walletAddr))\n\t\t}\n\t\trefreshAmount().catch(e => console.error(e))\n\t}, [getSigner])\n\n\tconst content = (\n\t\t<div>\n\t\t\t<p>\n\t\t\t\tThe ADX token completed a{\" \"}\n\t\t\t\t<a\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\thref=\"https://www.adex.network/blog/token-upgrade-defi-features/\"\n\t\t\t\t>\n\t\t\t\t\tsuccessful upgrade\n\t\t\t\t</a>{\" \"}\n\t\t\t\tto a new smart contract. You are currently holding{\" \"}\n\t\t\t\t<b>{amount.gt(ZERO) ? formatUnits(amount, 4) : \"\"} legacy ADX</b>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tStarting August 21st 2020, the{\" \"}\n\t\t\t\t<b>\n\t\t\t\t\tlegacy ADX will be deprecated and will no longer be traded on\n\t\t\t\t\texchanges\n\t\t\t\t</b>\n\t\t\t\t.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tWe recommend that you swap your legacy ADX right now by clicking the{\" \"}\n\t\t\t\t<i>\n\t\t\t\t\t<b>Swap now</b>\n\t\t\t\t</i>{\" \"}\n\t\t\t\tbutton and signing the MetaMask transactions.\n\t\t\t</p>\n\t\t</div>\n\t)\n\tconst onSwap = wrapDoingTxns(\n\t\tswapTokens.bind(null, setAmount, amount, getSigner)\n\t)\n\tconst dialog = ConfirmationDialog({\n\t\tisOpen: amount.gt(ZERO),\n\t\tonDeny: () => setAmount(ZERO),\n\t\tonConfirm: async () => {\n\t\t\tconst txns = await onSwap()\n\t\t\tsetSwapInPrg(true)\n\t\t\tawait Promise.all(txns.map(x => x.wait()))\n\t\t\tsetSwapInPrg(false)\n\t\t},\n\t\tconfirmActionName: \"Swap now\",\n\t\ttitle: \"ADX Token ugprade\",\n\t\tcontent\n\t})\n\treturn (\n\t\t<>\n\t\t\t{dialog}\n\t\t\t<Snackbar open={isSwapInPrg}>\n\t\t\t\t<MuiAlert elevation={6} variant=\"filled\" severity=\"success\">\n\t\t\t\t\tToken swap is in progress! It will be completed once all your pending\n\t\t\t\t\ttransactions have been confirmed.\n\t\t\t\t</MuiAlert>\n\t\t\t</Snackbar>\n\t\t</>\n\t)\n}\n\nasync function swapTokens(setAmount, amount, getSigner) {\n\tsetAmount(ZERO)\n\tconst signer = await getSigner()\n\tconst walletAddr = await signer.getAddress()\n\tconst legacyTokenWithSigner = new Contract(ADDR_ADX_OLD, ERC20ABI, signer)\n\tconst newTokenWithSigner = new Contract(\n\t\tADDR_ADX,\n\t\t[\"function swap(uint prevTokenAmount) external\"],\n\t\tsigner\n\t)\n\tconst allowance = await legacyTokenWithSigner.allowance(walletAddr, ADDR_ADX)\n\n\tlet txns = []\n\t// this mechanism is used so that we auto-calculate gas on the first tx, but hard-set on the next txns since they depend\n\t// on the state of the previous\n\tlet hasAutocalculatedGas = false\n\tconst firstTimeGasLimit = gasLimit => {\n\t\tif (hasAutocalculatedGas) return { gasLimit }\n\t\thasAutocalculatedGas = true\n\t\treturn {}\n\t}\n\tif (allowance.lt(amount)) {\n\t\tif (allowance.gt(ZERO)) {\n\t\t\ttxns.push(\n\t\t\t\tawait legacyTokenWithSigner.approve(\n\t\t\t\t\tADDR_ADX,\n\t\t\t\t\tZERO,\n\t\t\t\t\tfirstTimeGasLimit(60000)\n\t\t\t\t)\n\t\t\t)\n\t\t}\n\t\ttxns.push(\n\t\t\tawait legacyTokenWithSigner.approve(\n\t\t\t\tADDR_ADX,\n\t\t\t\tamount,\n\t\t\t\tfirstTimeGasLimit(60000)\n\t\t\t)\n\t\t)\n\t}\n\ttxns.push(await newTokenWithSigner.swap(amount, firstTimeGasLimit(80000)))\n\treturn txns\n}\n","import React, { useEffect, useState } from \"react\"\nimport { MuiThemeProvider } from \"@material-ui/core/styles\"\nimport { themeMUI } from \"./themeMUi\"\nimport AppBar from \"@material-ui/core/AppBar\"\nimport Toolbar from \"@material-ui/core/Toolbar\"\nimport Modal from \"@material-ui/core/Modal\"\nimport Backdrop from \"@material-ui/core/Backdrop\"\nimport Fab from \"@material-ui/core/Fab\"\nimport AddIcon from \"@material-ui/icons/Add\"\nimport Fade from \"@material-ui/core/Fade\"\nimport Snackbar from \"@material-ui/core/Snackbar\"\nimport MuiAlert from \"@material-ui/lab/Alert\"\nimport HelperMenu from \"./components/HelperMenu\"\nimport logo from \"./adex-staking.svg\"\nimport { Contract, getDefaultProvider } from \"ethers\"\nimport { bigNumberify, hexZeroPad } from \"ethers/utils\"\nimport { Web3Provider } from \"ethers/providers\"\nimport BalanceTree from \"adex-protocol-eth/js/BalanceTree\"\nimport { splitSig } from \"adex-protocol-eth/js\"\nimport StakingABI from \"adex-protocol-eth/abi/Staking\"\nimport IdentityABI from \"adex-protocol-eth/abi/Identity\"\nimport CoreABI from \"adex-protocol-eth/abi/AdExCore\"\nimport FactoryABI from \"adex-protocol-eth/abi/IdentityFactory\"\nimport ERC20ABI from \"./abi/ERC20\"\nimport Dashboard from \"./components/Dashboard\"\nimport NewBondForm from \"./components/NewBondForm\"\nimport LegacyADXSwapDialog from \"./components/LegacyADXSwapDialog\"\nimport ConfirmationDialog from \"./components/ConfirmationDialog\"\nimport {\n\tADDR_STAKING,\n\tADDR_FACTORY,\n\tADDR_ADX,\n\tMAX_UINT,\n\tZERO,\n\tUNBOND_DAYS,\n\tPOOLS\n} from \"./helpers/constants\"\nimport { formatADXPretty } from \"./helpers/formatting\"\nimport { getBondId } from \"./helpers/bonds\"\nimport { getUserIdentity, zeroFeeTx } from \"./helpers/identity\"\n\nconst ADDR_CORE = \"0x333420fc6a897356e69b62417cd17ff012177d2b\"\n// const ADDR_ADX_OLD = \"0x4470bb87d77b963a013db939be332f927f2b992e\"\nconst REFRESH_INTVL = 20000\n\nconst provider = getDefaultProvider()\nconst Staking = new Contract(ADDR_STAKING, StakingABI, provider)\nconst Token = new Contract(ADDR_ADX, ERC20ABI, provider)\nconst Core = new Contract(ADDR_CORE, CoreABI, provider)\n\nconst MAX_SLASH = bigNumberify(\"1000000000000000000\")\n\n// 0.2 DAI or ADX\nconst OUTSTANDING_REWARD_THRESHOLD = bigNumberify(\"200000000000000000\")\n\nconst EMPTY_STATS = {\n\tloaded: false,\n\tuserBonds: [],\n\tuserBalance: ZERO,\n\ttotalStake: ZERO\n}\n\nfunction Alert(props) {\n\treturn <MuiAlert elevation={6} variant=\"filled\" {...props} />\n}\n\nexport default function App() {\n\tconst [isNewBondOpen, setNewBondOpen] = useState(false)\n\tconst [toUnbond, setToUnbond] = useState(null)\n\tconst [toRestake, setToRestake] = useState(null)\n\tconst [openErr, setOpenErr] = useState(false)\n\tconst [openDoingTx, setOpenDoingTx] = useState(false)\n\tconst [snackbarErr, setSnackbarErr] = useState(\n\t\t\"Error! Unspecified error occured.\"\n\t)\n\tconst [stats, setStats] = useState(EMPTY_STATS)\n\n\tconst refreshStats = () =>\n\t\tloadStats()\n\t\t\t.then(setStats)\n\t\t\t.catch(e => {\n\t\t\t\tconsole.error(\"loadStats\", e)\n\t\t\t\tsetOpenErr(true)\n\t\t\t\tif (e.code === 4001) {\n\t\t\t\t\tsetSnackbarErr(\"Error! User denied authorization!\")\n\t\t\t\t}\n\t\t\t})\n\tuseEffect(() => {\n\t\trefreshStats()\n\t\tconst intvl = setInterval(refreshStats, REFRESH_INTVL)\n\t\treturn () => clearInterval(intvl)\n\t}, [])\n\n\tconst wrapDoingTxns = fn => async (...args) => {\n\t\ttry {\n\t\t\tsetOpenDoingTx(true)\n\t\t\tsetOpenErr(false)\n\t\t\tconst res = await fn.apply(null, args)\n\t\t\tsetOpenDoingTx(false)\n\t\t\treturn res\n\t\t} catch (e) {\n\t\t\tconsole.error(e)\n\t\t\tsetOpenDoingTx(false)\n\t\t\tsetOpenErr(true)\n\t\t\tsetSnackbarErr(e.message || \"Unknown error\")\n\t\t}\n\t}\n\tconst onRequestUnbond = wrapDoingTxns(onUnbondOrRequest.bind(null, false))\n\tconst onUnbond = wrapDoingTxns(onUnbondOrRequest.bind(null, true))\n\tconst onClaimRewards = wrapDoingTxns(claimRewards)\n\tconst onRestake = wrapDoingTxns(restake.bind(null, stats))\n\tconst handleErrClose = (event, reason) => {\n\t\tif (reason === \"clickaway\") {\n\t\t\treturn\n\t\t}\n\t\tsetOpenErr(false)\n\t}\n\n\treturn (\n\t\t<MuiThemeProvider theme={themeMUI}>\n\t\t\t<AppBar position=\"static\">\n\t\t\t\t<Toolbar>\n\t\t\t\t\t<img height=\"40vh\" src={logo} alt=\"logo\"></img>\n\t\t\t\t\t<Fab\n\t\t\t\t\t\tdisabled={!stats.loaded}\n\t\t\t\t\t\tonClick={() => setNewBondOpen(true)}\n\t\t\t\t\t\tvariant=\"extended\"\n\t\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\t\tstyle={{ position: \"absolute\", right: \"5%\", top: \"50%\" }}\n\t\t\t\t\t>\n\t\t\t\t\t\t<AddIcon style={{ margin: themeMUI.spacing(1) }} />\n\t\t\t\t\t\t{\"Stake your ADX\"}\n\t\t\t\t\t</Fab>\n\t\t\t\t\t{HelperMenu()}\n\t\t\t\t</Toolbar>\n\t\t\t</AppBar>\n\n\t\t\t{Dashboard({\n\t\t\t\tstats,\n\t\t\t\tonRequestUnbond: setToUnbond,\n\t\t\t\tonUnbond,\n\t\t\t\tonClaimRewards,\n\t\t\t\tonRestake: setToRestake\n\t\t\t})}\n\n\t\t\t{// Load stats first to prevent simultanious calls to getSigner\n\t\t\tLegacyADXSwapDialog(stats.loaded ? getSigner : null, wrapDoingTxns)}\n\n\t\t\t{ConfirmationDialog({\n\t\t\t\tisOpen: !!toUnbond,\n\t\t\t\tonDeny: () => setToUnbond(null),\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tif (toUnbond) onRequestUnbond(toUnbond)\n\t\t\t\t\tsetToUnbond(null)\n\t\t\t\t},\n\t\t\t\tconfirmActionName: \"Unbond\",\n\t\t\t\tcontent: (\n\t\t\t\t\t<>\n\t\t\t\t\t\tAre you sure you want to request unbonding of{\" \"}\n\t\t\t\t\t\t{formatADXPretty(toUnbond ? toUnbond.currentAmount : ZERO)} ADX?\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\tPlease be aware:\n\t\t\t\t\t\t<ol>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\tIt will take {UNBOND_DAYS} days before you will be able to\n\t\t\t\t\t\t\t\twithdraw your ADX!\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\tYou will not receive staking rewards for this amount in this{\" \"}\n\t\t\t\t\t\t\t\t{UNBOND_DAYS} day period.\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ol>\n\t\t\t\t\t</>\n\t\t\t\t)\n\t\t\t})}\n\n\t\t\t{ConfirmationDialog({\n\t\t\t\tisOpen: !!toRestake,\n\t\t\t\tonDeny: () => setToRestake(null),\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tif (toRestake) onRestake()\n\t\t\t\t\tsetToRestake(null)\n\t\t\t\t},\n\t\t\t\tconfirmActionName: \"Re-stake\",\n\t\t\t\tcontent: (\n\t\t\t\t\t<>\n\t\t\t\t\t\tAre you sure you want to stake your earnings of{\" \"}\n\t\t\t\t\t\t{formatADXPretty(toRestake ? toRestake : ZERO)} ADX?\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\tPlease be aware that this means that this amount will be locked up\n\t\t\t\t\t\tfor at least {UNBOND_DAYS} days.\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t{!stats.userBonds.find(x => x.status === \"Active\")\n\t\t\t\t\t\t\t? \"Your bond will be re-activated, meaning that your request to unbond will be cancelled but it will start earning rewards again.\"\n\t\t\t\t\t\t\t: \"\"}\n\t\t\t\t\t</>\n\t\t\t\t)\n\t\t\t})}\n\n\t\t\t<Snackbar open={openDoingTx}>\n\t\t\t\t<Alert severity=\"info\">Please sign all pending MetaMask actions!</Alert>\n\t\t\t</Snackbar>\n\t\t\t<Snackbar\n\t\t\t\topen={openErr}\n\t\t\t\tautoHideDuration={10000}\n\t\t\t\tonClose={handleErrClose}\n\t\t\t>\n\t\t\t\t<Alert onClose={handleErrClose} severity=\"error\">\n\t\t\t\t\t{snackbarErr}\n\t\t\t\t</Alert>\n\t\t\t</Snackbar>\n\n\t\t\t<Modal\n\t\t\t\topen={isNewBondOpen}\n\t\t\t\tonClose={() => setNewBondOpen(false)}\n\t\t\t\tstyle={{\n\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\talignItems: \"center\",\n\t\t\t\t\tjustifyContent: \"center\"\n\t\t\t\t}}\n\t\t\t\tcloseAfterTransition\n\t\t\t\tBackdropComponent={Backdrop}\n\t\t\t\tBackdropProps={{\n\t\t\t\t\ttimeout: 300\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Fade in={isNewBondOpen}>\n\t\t\t\t\t{NewBondForm({\n\t\t\t\t\t\tpools: POOLS.filter(x => x.selectable),\n\t\t\t\t\t\ttotalStake: stats.totalStake,\n\t\t\t\t\t\tmaxAmount: stats.userBalance,\n\t\t\t\t\t\tonNewBond: async bond => {\n\t\t\t\t\t\t\tsetNewBondOpen(false)\n\t\t\t\t\t\t\tawait wrapDoingTxns(createNewBond.bind(null, stats, bond))()\n\t\t\t\t\t\t}\n\t\t\t\t\t})}\n\t\t\t\t</Fade>\n\t\t\t</Modal>\n\t\t</MuiThemeProvider>\n\t)\n}\n\nasync function getSigner() {\n\tif (typeof window.ethereum !== \"undefined\") {\n\t\tawait window.ethereum.enable()\n\t}\n\n\tif (!window.web3) return null\n\n\tconst provider = new Web3Provider(window.web3.currentProvider)\n\tconst signer = provider.getSigner()\n\treturn signer\n}\n\nasync function loadStats() {\n\tconst [totalStake, userStats] = await Promise.all([\n\t\tToken.balanceOf(ADDR_STAKING),\n\t\tloadUserStats()\n\t])\n\n\treturn { totalStake, ...userStats }\n}\n\nasync function loadUserStats() {\n\tconst signer = await getSigner()\n\tif (!signer)\n\t\treturn {\n\t\t\tloaded: true,\n\t\t\tuserBonds: [],\n\t\t\tuserBalance: ZERO,\n\t\t\trewardChannels: []\n\t\t}\n\tconst addr = await signer.getAddress()\n\n\tconst [bondStats, rewardChannels] = await Promise.all([\n\t\tloadBondStats(addr),\n\t\tgetRewards(addr)\n\t])\n\treturn { ...bondStats, loaded: true, rewardChannels }\n}\n\nasync function loadBondStats(addr) {\n\tconst identityAddr = getUserIdentity(addr).addr\n\tconst [balances, logs, slashLogs] = await Promise.all([\n\t\tPromise.all([Token.balanceOf(addr), Token.balanceOf(identityAddr)]),\n\t\tprovider.getLogs({\n\t\t\tfromBlock: 0,\n\t\t\taddress: ADDR_STAKING,\n\t\t\ttopics: [null, hexZeroPad(identityAddr, 32)]\n\t\t}),\n\t\tprovider.getLogs({ fromBlock: 0, ...Staking.filters.LogSlash(null, null) })\n\t])\n\n\tconst userBalance = balances.reduce((a, b) => a.add(b))\n\n\tconst slashedByPool = slashLogs.reduce((pools, log) => {\n\t\tconst { poolId, newSlashPts } = Staking.interface.parseLog(log).values\n\t\tpools[poolId] = newSlashPts\n\t\treturn pools\n\t}, {})\n\n\tconst userBonds = logs.reduce((bonds, log) => {\n\t\tconst topic = log.topics[0]\n\t\tconst evs = Staking.interface.events\n\t\tif (topic === evs.LogBond.topic) {\n\t\t\tconst vals = Staking.interface.parseLog(log).values\n\t\t\tconst { owner, amount, poolId, nonce, slashedAtStart, time } = vals\n\t\t\tconst bond = { owner, amount, poolId, nonce, slashedAtStart, time }\n\t\t\tbonds.push({\n\t\t\t\tid: getBondId(bond),\n\t\t\t\tstatus: \"Active\",\n\t\t\t\tcurrentAmount: bond.amount\n\t\t\t\t\t.mul(MAX_SLASH.sub(slashedByPool[poolId] || ZERO))\n\t\t\t\t\t.div(MAX_SLASH.sub(slashedAtStart)),\n\t\t\t\t...bond\n\t\t\t})\n\t\t} else if (topic === evs.LogUnbondRequested.topic) {\n\t\t\t// NOTE: assuming that .find() will return something is safe, as long as the logs are properly ordered\n\t\t\tconst { bondId, willUnlock } = Staking.interface.parseLog(log).values\n\t\t\tconst bond = bonds.find(({ id }) => id === bondId)\n\t\t\tbond.status = \"UnbondRequested\"\n\t\t\tbond.willUnlock = new Date(willUnlock * 1000)\n\t\t} else if (topic === evs.LogUnbonded.topic) {\n\t\t\tconst { bondId } = Staking.interface.parseLog(log).values\n\t\t\tbonds.find(({ id }) => id === bondId).status = \"Unbonded\"\n\t\t}\n\t\treturn bonds\n\t}, [])\n\n\treturn { userBonds, userBalance }\n}\n\nasync function getRewards(addr) {\n\tconst identityAddr = getUserIdentity(addr).addr\n\tconst rewardPool = POOLS[0]\n\tconst resp = await fetch(`${rewardPool.url}/fee-rewards`)\n\tconst rewardChannels = await resp.json()\n\tconst validUntil = Math.floor(Date.now() / 1000)\n\tconst forUser = await Promise.all(\n\t\trewardChannels.map(async rewardChannel => {\n\t\t\tif (rewardChannel.channelArgs.validUntil < validUntil) return null\n\t\t\tconst claimFrom = rewardChannel.balances[addr] ? addr : identityAddr\n\t\t\tif (!rewardChannel.balances[claimFrom]) return null\n\t\t\tconst balanceTree = new BalanceTree(rewardChannel.balances)\n\t\t\tconst outstandingReward = bigNumberify(\n\t\t\t\trewardChannel.balances[claimFrom]\n\t\t\t).sub(await Core.withdrawnPerUser(rewardChannel.channelId, claimFrom))\n\t\t\tif (outstandingReward.lt(OUTSTANDING_REWARD_THRESHOLD)) return null\n\t\t\treturn {\n\t\t\t\t...rewardChannel,\n\t\t\t\toutstandingReward,\n\t\t\t\tclaimFrom,\n\t\t\t\tproof: balanceTree.getProof(claimFrom),\n\t\t\t\tstateRoot: balanceTree.mTree.getRoot(),\n\t\t\t\tamount: rewardChannel.balances[claimFrom]\n\t\t\t}\n\t\t})\n\t)\n\treturn forUser.filter(x => x)\n}\n\nasync function createNewBond(stats, { amount, poolId, nonce }) {\n\tif (!poolId) return\n\tif (!stats.userBalance) return\n\tif (amount.gt(stats.userBalance)) throw new Error(\"amount too large\")\n\n\tconst signer = await getSigner()\n\tif (!signer) throw new Error(\"failed to get signer\")\n\n\tconst walletAddr = await signer.getAddress()\n\tconst { addr } = getUserIdentity(walletAddr)\n\n\tconst bond = [\n\t\tamount,\n\t\tpoolId,\n\t\tnonce || bigNumberify(Math.floor(Date.now() / 1000))\n\t]\n\n\tconst [allowance, allowanceStaking, balanceOnIdentity] = await Promise.all([\n\t\tToken.allowance(walletAddr, addr),\n\t\tToken.allowance(addr, Staking.address),\n\t\tToken.balanceOf(addr)\n\t])\n\n\t// Eg bond amount is 10 but we only have 60, we need another 40\n\tconst needed = amount.sub(balanceOnIdentity)\n\tconst setAllowance = needed.gt(ZERO) && !allowance.gte(amount)\n\tif (setAllowance) {\n\t\tconst tokenWithSigner = new Contract(ADDR_ADX, ERC20ABI, signer)\n\t\tawait tokenWithSigner.approve(addr, MAX_UINT)\n\t}\n\n\tlet identityTxns = []\n\tif (needed.gt(ZERO))\n\t\tidentityTxns.push([\n\t\t\tToken.address,\n\t\t\tToken.interface.functions.transferFrom.encode([walletAddr, addr, amount])\n\t\t])\n\tif (allowanceStaking.lt(amount))\n\t\tidentityTxns.push([\n\t\t\tToken.address,\n\t\t\tToken.interface.functions.approve.encode([Staking.address, MAX_UINT])\n\t\t])\n\n\tconst active = stats.userBonds.find(\n\t\tx => x.status === \"Active\" && x.poolId === poolId\n\t)\n\tconst stakingData = active\n\t\t? Staking.interface.functions.replaceBond.encode([\n\t\t\t\tactive,\n\t\t\t\t[active.amount.add(amount), poolId, active.nonce]\n\t\t  ])\n\t\t: Staking.interface.functions.addBond.encode([bond])\n\tidentityTxns.push([Staking.address, stakingData])\n\n\tawait executeOnIdentity(\n\t\tidentityTxns,\n\t\tsetAllowance ? { gasLimit: 350000 } : {}\n\t)\n}\n\nasync function onUnbondOrRequest(isUnbond, { amount, poolId, nonce }) {\n\tconst bond = [amount, poolId, nonce || ZERO]\n\tif (isUnbond) {\n\t\tconst signer = await getSigner()\n\t\tif (!signer) throw new Error(\"failed to get signer\")\n\t\tconst walletAddr = await signer.getAddress()\n\t\tawait executeOnIdentity([\n\t\t\t[Staking.address, Staking.interface.functions.unbond.encode([bond])],\n\t\t\t[\n\t\t\t\tToken.address,\n\t\t\t\tToken.interface.functions.transfer.encode([walletAddr, amount])\n\t\t\t]\n\t\t])\n\t} else {\n\t\tawait executeOnIdentity([\n\t\t\t[\n\t\t\t\tStaking.address,\n\t\t\t\tStaking.interface.functions.requestUnbond.encode([bond])\n\t\t\t]\n\t\t])\n\t}\n}\n\nasync function claimRewards(rewardChannels) {\n\tconst signer = await getSigner()\n\tif (!signer) throw new Error(\"failed to get signer\")\n\tconst walletAddr = await signer.getAddress()\n\n\t// @TODO: this is obsolete, it should be removed at some point (when no more DAI rewards on wallets are left)\n\tconst coreWithSigner = new Contract(ADDR_CORE, CoreABI, signer)\n\tconst legacyChannels = rewardChannels.filter(\n\t\tchannel => channel.claimFrom === walletAddr\n\t)\n\tfor (const channel of legacyChannels) {\n\t\tconst channelTuple = toChannelTuple(channel.channelArgs)\n\t\tawait coreWithSigner.channelWithdraw(\n\t\t\tchannelTuple,\n\t\t\tchannel.stateRoot,\n\t\t\tchannel.signatures,\n\t\t\tchannel.proof,\n\t\t\tchannel.amount\n\t\t)\n\t}\n\n\tconst toTransfer = {}\n\trewardChannels.forEach(channel => {\n\t\tconst { tokenAddr } = channel.channelArgs\n\t\tconst amnt = toTransfer[tokenAddr] || ZERO\n\t\ttoTransfer[tokenAddr] = amnt.add(channel.outstandingReward)\n\t})\n\tconst identityTxns = rewardChannels\n\t\t.filter(channel => channel.claimFrom !== walletAddr)\n\t\t.map(channel => {\n\t\t\tconst channelTuple = toChannelTuple(channel.channelArgs)\n\t\t\treturn [\n\t\t\t\tCore.address,\n\t\t\t\tCore.interface.functions.channelWithdraw.encode([\n\t\t\t\t\tchannelTuple,\n\t\t\t\t\tchannel.stateRoot,\n\t\t\t\t\tchannel.signatures,\n\t\t\t\t\tchannel.proof,\n\t\t\t\t\tchannel.amount\n\t\t\t\t])\n\t\t\t]\n\t\t})\n\t\t.concat(\n\t\t\tObject.entries(toTransfer).map(([tokenAddr, amount]) => [\n\t\t\t\ttokenAddr,\n\t\t\t\tToken.interface.functions.transfer.encode([walletAddr, amount])\n\t\t\t])\n\t\t)\n\n\tif (identityTxns.length) {\n\t\tawait executeOnIdentity(identityTxns)\n\t}\n}\n\nasync function restake({ rewardChannels, userBonds }) {\n\tconst channels = rewardChannels.filter(\n\t\tx => x.channelArgs.tokenAddr === ADDR_ADX\n\t)\n\tif (!channels.length) throw new Error(\"no channels to earn from\")\n\n\t// @TODO how does the user determine the pool here? For now there's only one, but after?\n\tconst collected = channels\n\t\t.map(x => x.outstandingReward)\n\t\t.reduce((a, b) => a.add(b))\n\tconst userBond =\n\t\tuserBonds.find(x => x.status === \"Active\") ||\n\t\tuserBonds.find(x => x.status === \"UnbondRequested\")\n\tif (!userBond) throw new Error(\"You have no active bonds\")\n\tconst { amount, poolId, nonce } = userBond\n\tconst bond = [amount, poolId, nonce]\n\tconst newBond = [amount.add(collected), poolId, nonce]\n\n\tconst identityTxns = channels\n\t\t.map(rewardChannel => {\n\t\t\tconst channelTuple = toChannelTuple(rewardChannel.channelArgs)\n\t\t\treturn [\n\t\t\t\tCore.address,\n\t\t\t\tCore.interface.functions.channelWithdraw.encode([\n\t\t\t\t\tchannelTuple,\n\t\t\t\t\trewardChannel.stateRoot,\n\t\t\t\t\trewardChannel.signatures,\n\t\t\t\t\trewardChannel.proof,\n\t\t\t\t\trewardChannel.amount\n\t\t\t\t])\n\t\t\t]\n\t\t})\n\t\t.concat([\n\t\t\t[\n\t\t\t\tToken.address,\n\t\t\t\tToken.interface.functions.approve.encode([Staking.address, newBond[0]])\n\t\t\t],\n\t\t\t[\n\t\t\t\tStaking.address,\n\t\t\t\tStaking.interface.functions.replaceBond.encode([bond, newBond])\n\t\t\t]\n\t\t])\n\n\tawait executeOnIdentity(identityTxns)\n}\n\nfunction toChannelTuple(args) {\n\treturn [\n\t\targs.creator,\n\t\targs.tokenAddr,\n\t\targs.tokenAmount,\n\t\targs.validUntil,\n\t\targs.validators,\n\t\targs.spec\n\t]\n}\n\nasync function executeOnIdentity(txns, opts = {}) {\n\tconst signer = await getSigner()\n\tif (!signer) throw new Error(\"failed to get signer\")\n\tconst walletAddr = await signer.getAddress()\n\tconst { addr, bytecode } = getUserIdentity(walletAddr)\n\tconst identity = new Contract(addr, IdentityABI, signer)\n\n\tconst needsToDeploy = (await provider.getCode(identity.address)) === \"0x\"\n\tconst idNonce = needsToDeploy ? ZERO : await identity.nonce()\n\tconst toTuples = offset => ([to, data], i) =>\n\t\tzeroFeeTx(\n\t\t\tidentity.address,\n\t\t\tidNonce.add(i + offset),\n\t\t\tto,\n\t\t\tdata\n\t\t).toSolidityTuple()\n\tif (!needsToDeploy) {\n\t\tconst txnTuples = txns.map(toTuples(0))\n\t\tawait identity.executeBySender(txnTuples, opts)\n\t} else {\n\t\tconst factoryWithSigner = new Contract(ADDR_FACTORY, FactoryABI, signer)\n\t\t// Has offset because the execute() takes the first nonce\n\t\tconst txnTuples = txns.map(toTuples(1))\n\t\tconst executeTx = zeroFeeTx(\n\t\t\tidentity.address,\n\t\t\tidNonce,\n\t\t\tidentity.address,\n\t\t\tidentity.interface.functions.executeBySender.encode([txnTuples])\n\t\t)\n\t\tconst sig = await signer.signMessage(executeTx.hash())\n\t\tawait factoryWithSigner.deployAndExecute(\n\t\t\tbytecode,\n\t\t\t0,\n\t\t\t[executeTx.toSolidityTuple()],\n\t\t\t[splitSig(sig)],\n\t\t\topts\n\t\t)\n\t}\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","import React, { useState } from \"react\"\nimport IconButton from \"@material-ui/core/IconButton\"\nimport Menu from \"@material-ui/core/Menu\"\nimport HelpIcon from \"@material-ui/icons/HelpOutline\"\nimport Link from \"@material-ui/core/Link\"\nimport MenuItem from \"@material-ui/core/MenuItem\"\nexport default () => {\n\tconst [menuEl, setMenuEl] = useState(null)\n\tconst openHelpMenu = ev => {\n\t\tsetMenuEl(ev.currentTarget)\n\t}\n\tconst closeHelpMenu = () => {\n\t\tsetMenuEl(null)\n\t}\n\treturn (\n\t\t<>\n\t\t\t<IconButton\n\t\t\t\tstyle={{ position: \"absolute\", right: \"1.25%\", top: \"10%\" }}\n\t\t\t\tonClick={openHelpMenu}\n\t\t\t>\n\t\t\t\t<HelpIcon style={{ fontSize: \"1.5em\", color: \"white\" }} />\n\t\t\t</IconButton>\n\t\t\t<Menu\n\t\t\t\tid=\"simple-menu\"\n\t\t\t\tanchorEl={menuEl}\n\t\t\t\topen={Boolean(menuEl)}\n\t\t\t\tkeepMounted\n\t\t\t\tonClose={closeHelpMenu}\n\t\t\t\tgetContentAnchorEl={null}\n\t\t\t\tanchorOrigin={{ vertical: \"bottom\", horizontal: \"center\" }}\n\t\t\t\ttransformOrigin={{ vertical: \"top\", horizontal: \"center\" }}\n\t\t\t>\n\t\t\t\t<Link href=\"https://www.adex.network/tos\" target=\"_blank\">\n\t\t\t\t\t<MenuItem onClick={closeHelpMenu}>Terms of Service</MenuItem>\n\t\t\t\t</Link>\n\t\t\t\t<Link\n\t\t\t\t\thref=\"https://help.adex.network/hc/en-us/categories/360002707720-Staking\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t>\n\t\t\t\t\t<MenuItem onClick={closeHelpMenu}>User Guide</MenuItem>\n\t\t\t\t</Link>\n\t\t\t\t<Link\n\t\t\t\t\thref=\"https://github.com/adexnetwork/adex-protocol-eth\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t>\n\t\t\t\t\t<MenuItem onClick={closeHelpMenu}>Source Code</MenuItem>\n\t\t\t\t</Link>\n\t\t\t\t<Link\n\t\t\t\t\thref=\"https://github.com/adexnetwork/adex-protocol-eth#audits\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t>\n\t\t\t\t\t<MenuItem onClick={closeHelpMenu}>Audits</MenuItem>\n\t\t\t\t</Link>\n\t\t\t\t<Link\n\t\t\t\t\thref=\"https://coinmarketcap.com/currencies/adx-net/markets/\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t>\n\t\t\t\t\t<MenuItem onClick={closeHelpMenu}>Where to buy ADX</MenuItem>\n\t\t\t\t</Link>\n\t\t\t</Menu>\n\t\t</>\n\t)\n}\n","import { generateAddress2 } from \"ethereumjs-util\"\nimport { getAddress } from \"ethers/utils\"\nimport { Transaction } from \"adex-protocol-eth/js\"\nimport { ADDR_FACTORY } from \"./constants\"\n\nfunction getBytecode(addr) {\n\tconst addrHex = addr.slice(2).toLowerCase()\n\t// Do not change that bytecode! It comes from compiling this https://gist.github.com/Ivshti/e66cd57ade1abfb07c2517df9e73ceb9\n\treturn `0x608060405234801561001057600080fd5b5060026000803073ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908360ff160217905550600260008073${addrHex}73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908360ff1602179055506000734470bb87d77b963a013db939be332f927f2b992e9050600073ade00c28244d5ce17d72e40330b1c318cd12b7c3905060008273ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004016101429190610501565b60206040518083038186803b15801561015a57600080fd5b505afa15801561016e573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610192919061045a565b90506000811115610276578273ffffffffffffffffffffffffffffffffffffffff1663095ea7b383836040518363ffffffff1660e01b81526004016101d892919061051c565b600060405180830381600087803b1580156101f257600080fd5b505af1158015610206573d6000803e3d6000fd5b505050508173ffffffffffffffffffffffffffffffffffffffff166394b918de826040518263ffffffff1660e01b81526004016102439190610560565b600060405180830381600087803b15801561025d57600080fd5b505af1158015610271573d6000803e3d6000fd5b505050505b60008273ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004016102b19190610501565b60206040518083038186803b1580156102c957600080fd5b505afa1580156102dd573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610301919061045a565b9050600081111561043c576000734846c6837ec670bbd1f5b485471c8f64ecb9c53490508373ffffffffffffffffffffffffffffffffffffffff1663095ea7b382846040518363ffffffff1660e01b815260040161036092919061051c565b600060405180830381600087803b15801561037a57600080fd5b505af115801561038e573d6000803e3d6000fd5b505050508073ffffffffffffffffffffffffffffffffffffffff1663b4dca72460405180606001604052808581526020017f2ce0c96383fb229d9776f33846e983a956a7d95844fac57b180ed0071d93bb2860001b8152602001428152506040518263ffffffff1660e01b81526004016104089190610545565b600060405180830381600087803b15801561042257600080fd5b505af1158015610436573d6000803e3d6000fd5b50505050505b505050506105d8565b600081519050610454816105c1565b92915050565b60006020828403121561046c57600080fd5b600061047a84828501610445565b91505092915050565b61048c8161057b565b82525050565b61049b8161058d565b82525050565b6060820160008201516104b760008501826104e3565b5060208201516104ca6020850182610492565b5060408201516104dd60408501826104e3565b50505050565b6104ec816105b7565b82525050565b6104fb816105b7565b82525050565b60006020820190506105166000830184610483565b92915050565b60006040820190506105316000830185610483565b61053e60208301846104f2565b9392505050565b600060608201905061055a60008301846104a1565b92915050565b600060208201905061057560008301846104f2565b92915050565b600061058682610597565b9050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b6105ca816105b7565b81146105d557600080fd5b50565b6101b7806105e76000396000f3fe608060405234801561001057600080fd5b506004361061002f5760003560e01c8063c066a5b11461007357610030565b5b60007396e3cb4b4632ed45363ff2c9f0fbec9b583d9d3a90503660008037600080366000846127105a03f43d6000803e806000811461006e573d6000f35b3d6000fd5b61008d600480360381019061008891906100d8565b6100a3565b60405161009a9190610110565b60405180910390f35b60006020528060005260406000206000915054906101000a900460ff1681565b6000813590506100d28161016a565b92915050565b6000602082840312156100ea57600080fd5b60006100f8848285016100c3565b91505092915050565b61010a8161015d565b82525050565b60006020820190506101256000830184610101565b92915050565b60006101368261013d565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600060ff82169050919050565b6101738161012b565b811461017e57600080fd5b5056fea26469706673582212200e40aa3025d54e828fb973089b64ce06688fedcd71b98ae68521a0217652c59564736f6c634300060c0033`\n}\n\nexport function getUserIdentity(walletAddr) {\n\tconst bytecode = getBytecode(walletAddr)\n\tconst addr = getAddress(\n\t\t`0x${generateAddress2(ADDR_FACTORY, Buffer.alloc(32), bytecode).toString(\n\t\t\t\"hex\"\n\t\t)}`\n\t)\n\treturn { bytecode, addr }\n}\n\nexport function zeroFeeTx(idAddr, nonce, to, data) {\n\treturn new Transaction({\n\t\tidentityContract: idAddr,\n\t\tnonce: nonce.toString(10),\n\t\tfeeTokenAddr: \"0x6b175474e89094c44da98b954eedeac495271d0f\",\n\t\tfeeAmount: 0,\n\t\tto,\n\t\tdata\n\t})\n}\n","import { bigNumberify, id } from \"ethers/utils\"\n\nexport const ADDR_STAKING = \"0x4846c6837ec670bbd1f5b485471c8f64ecb9c534\"\nexport const ZERO = bigNumberify(0)\nexport const PRICES_API_URL =\n\t\"https://min-api.cryptocompare.com/data/price?fsym=ADX&tsyms=BTC,USD,EUR\"\nexport const UNBOND_DAYS = 30\nexport const STAKING_RULES_URL = null\n\nexport const ADDR_ADX = \"0xADE00C28244d5CE17D72E40330B1c318cD12B7c3\"\nexport const ADDR_FACTORY = \"0x9fe0d438e3c29c7cff949ad8e8da9403a531cc1a\"\n\nexport const MAX_UINT = bigNumberify(\n\t\"115792089237316195423570985008687907853269984665640564039457584007913129639935\"\n)\n\nexport const DEFAULT_BOND = {\n\tpoolId: \"\",\n\tamount: ZERO\n}\n\nexport const POOLS = [\n\t{\n\t\tlabel: \"Validator Tom\",\n\t\tid: id(\"validator:0x2892f6C41E0718eeeDd49D98D648C789668cA67d\"),\n\t\tselectable: true,\n\t\tminStakingAmount: \"0.0\",\n\t\trewardPolicy:\n\t\t\t'The \"Validator Tom\" pool will distribute its fee earnings proportionally to each staker. The fee earnings will be 7% of the total volume, which you can track on our Explorer. There is an additional incentive reward of 7 million ADX to be distributed by the end of 2020.',\n\t\tslashPolicy: \"No slashing.\",\n\t\turl: \"https://tom.adex.network\",\n\t\testimatedAnnualFeeYield: 182500,\n\t\testimatedAnnualADXYield: 15103448.2758,\n\t\testimatedAnnualADXEarlyYield: 12166666.6666\n\t},\n\t{\n\t\tlabel: \"Validator Jerry\",\n\t\tid: id(\"validator:0xce07CbB7e054514D590a0262C93070D838bFBA2e\"),\n\t\tselectable: false,\n\t\tminStakingAmount: 0,\n\t\trewardPolicy: \"\",\n\t\tslashPolicy: \"\"\n\t}\n]\n\nexport const TOKEN_OLD_TO_NEW_MULTIPLIER = bigNumberify(\"100000000000000\")\n"],"sourceRoot":""}